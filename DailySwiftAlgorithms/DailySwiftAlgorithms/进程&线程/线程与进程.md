---
typora-root-url: ../shared
---

> 在面试中我们经常会被面试官问到线程是什么，进程是什么，以及二者之间的联系。然后我们大部分人的回答基本上都是如下：
>
> 线程是CPU独立运行和独立调度的基本单位（可以理解为一个进程中执行的代码片段），进程是资源分配的基本单位（进程是一块包含了某些资源的内存区域）。进程是线程的容器，真正完成代码执行的是线程，而进程则作为线程的执行环境。一个程序至少包含一个进程，一个进程至少包含一个线程，一个进程中的多个线程共享当前进程所拥有的资源。

##进程

进程是操作系统对一个正在运行的程序的抽象，可以简单理解为一个进程就是一个正在运行的程序。

逼格高一点，可以简单理解为每个程序就是一个字节块，而程序本身就是一个字节序列，然后操作系统让字节运行起来，让程序发挥作用。

逼格再高一点，怎么讲？程序本身就是磁盘上的一堆指令(也可能是一些静态数据)，然后CPU不间断的一条一条的执行程序中的指令，也就是说程序的代码和数据是系统内存中唯一的对象。

### 进程的创建

在操作系统中，我们的应用程序基本上都是以一种可执行文件的格式存储在磁盘上。

程序的运行是在内存中。

系统在创建或撤销进程时，都会为它分配或者回收资源，所谓的资源比如内存空间、I/O设备。

操作系统运行程序，首先就是将程序和所有的静态数据加载到内存中，加载到进程的地址空间中。

![加载：从程序到进程](/../进程&线程/加载：从程序到进程.png)

上图基本上就是程序加载到内存，操作系统所必须执行的一些操作的简单介绍。其中代码片段以及相关数据加载到内存的过程中，是一个懒加载的过程，具体的细节大家可以看一下虚拟内存相关的资料或者文章。



> *引申：在任何时刻，单核处理器系统都只能执行一个进程的代码。当我们启动并运行新程序时，就涉及到进程的切换（进程上下文切换），而进程的切换又涉及到了内核态和用户态，以及进程调度的相关知识，大家有兴趣的又有机会查资料看文档买书了。*

这里简单给个示例图：

![进程上下文切换](/../进程&线程/进程上下文切换.png)

以上简单粗浅的介绍了进程，可以看到进程在加载到内存的时候，确实分配了很多内存空间，且每个进程被分配的内存空间都是被隔离被保护的。那么线程就不分配资源了吗？

##线程

刚一开始讲到一个进程至少包含一个线程，也就是说一个进程可以包含多个线程，而处于同一个进程中的所有线程都运行在该进程的上下文当中，并共享了该进程的整个虚拟地址空间，也就是说共享了该进程虚拟地址空间的所有内容，包括代码，数据，堆，共享库，打开的文件。

从上面这段话，至少可以看出，线程之间的上下文切换不需要变换地址空间(或者说不需要切换当前使用的页表)，因为他们共享同一进程的地址空间。

> *引申：页表代表每一个进程的数据结构，用于记录进程虚拟内存到物理内存的映射关系，这部分有兴趣的可以看一下虚拟内存相关的资料；共享库的概念可以在程序的编译与链接相关资料里面查阅。*

那线程有什么，首先线程作为CPU独立运行和调度的基本单元，既然线程也是基本单元，那线程肯定也有它自己的上下文，线程的上下文中有什么？包含线程的ID，线程的**栈**，栈指针，PC，通用寄存器，条件码。